<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>-v-</title>
</head>
<body>
<input type="file" id="file"/>
<br/>
<br/>
<button onclick="Upload()">上传</button>
<br/>
<br/>
<a id="state"></a>
<script>
    function Upload() {
        let i = document.getElementById("file")
        let state = document.getElementById("state")
        if(i.files.length===0){alert('请选择文件');return}
        i.setAttribute("disabled","true")
        const fileObj = i.files[0];
        const form = new FormData();
        form.append("file", fileObj);
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "/upload", true);
        xhr.onload = xhr.onerror = e=>{
            i.removeAttribute("disabled")
            if(e){
                switch (e.type){
                    case "load":
                        state.innerText="上传成功"
                        break
                    case "error":
                        state.innerText="上传失败"
                        break
                }
            }
        }
        xhr.upload.onprogress = e=>{
            state.innerText=`${((e.loaded/e.total)*100).toFixed(2)}%`
        }
        xhr.send(form);
    }
</script>
</body>
</html>